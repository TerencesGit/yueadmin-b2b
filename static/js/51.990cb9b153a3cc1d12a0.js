webpackJsonp([51],{1007:function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",[i("el-row",{staticClass:"toolbar"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.uploadVisible=!0}}},[e._v("本地上传")]),e._v(" "),i("el-button",{attrs:{type:"danger",disabled:0===this.sels.length},on:{click:e.batchRemove}},[e._v("批量删除")])],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{border:"",data:e.mediaList,"highlight-current-row":""},on:{"selection-change":e.selsChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{type:"index",width:"60"}}),e._v(" "),i("el-table-column",{attrs:{label:"图片缩略图",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("img",{staticClass:"cell-img",attrs:{src:t.row.filePath,height:"60px"},on:{click:function(i){e.viewImage(t.row.filePath)}}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"更新者",prop:"createName",width:"100"}}),e._v(" "),i("el-table-column",{attrs:{label:"更新时间",prop:"createTime",formatter:e.formatCreateTime,sortable:""}}),e._v(" "),i("el-table-column",{attrs:{label:"是否显示",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-switch",{attrs:{"on-color":"#13ce66","off-color":"#ff4949","on-text":"是","off-text":"否","on-value":1,"off-value":0,disabled:1===t.row.isMainPic},on:{change:function(i){e.handleStatus(t.row)}},model:{value:t.row.status,callback:function(e){t.row.status=e},expression:"scope.row.status"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.isMainPic?i("div",[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(i){e.handleSetMainImg(t.row)}}},[e._v("设为主图")]),e._v(" "),i("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(i){e.handleSingleDelete(t.row)}}},[e._v("删除")])],1):i("div",[i("el-button",{attrs:{size:"small",type:"success"},on:{click:function(e){return!1}}},[e._v("当前主图")])],1)]}}])})],1),e._v(" "),i("el-row",{staticClass:"text-center m-t"},[i("el-button",{attrs:{size:"large",type:"primary"},on:{click:e.handleNext}},[e._v("下一步")])],1),e._v(" "),i("el-dialog",{attrs:{title:"本地上传",visible:e.uploadVisible,size:"small"},on:{"update:visible":function(t){e.uploadVisible=t}}},[i("el-row",[i("el-col",{class:{"text-danger":0===e.mediaLength},attrs:{span:20}},[e._v("\n\t\t\t\t\t建议上传大小为1024*512图片，单张不超过2M，最多上传"+e._s(e.maxLength)+"张，还可以上传"+e._s(e.mediaLength)+"张。\n\t\t\t\t")])],1),e._v(" "),i("el-row",{staticClass:"m-t"},[i("el-col",{attrs:{span:20}},[i("el-upload",{ref:"uploadMedia",staticClass:"multiple-uploader",attrs:{name:"fileName",data:e.uploadData,action:"https://jsonplaceholder.typicode.com/posts/","list-type":"picture-card",accept:"image/jpeg, image/png","on-preview":e.handleImgPreview,"on-remove":e.handleRemove,"before-upload":e.beforeUpload,"on-success":e.handleSuccess,"on-error":e.handleError,multiple:!0,disabled:0===e.mediaLength}},[i("i",{staticClass:"el-icon-plus"})])],1)],1),e._v(" "),i("div",{slot:"footer"},[i("el-button",{on:{click:function(t){e.uploadVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{size:"tiny"},model:{value:e.previewVisible,callback:function(t){e.previewVisible=t},expression:"previewVisible"}},[i("img",{attrs:{width:"100%",src:e.previewImgUrl}})])],1)},staticRenderFns:[]}},791:function(e,t,i){var a=i(10)(i(875),i(1007),null,null);e.exports=a.exports},875:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(70);t.default={data:function(){return{wareId:"",maxLength:10,previewImgUrl:"",uploadVisible:!1,previewVisible:!1,fileList:[],mediaList:[{fileId:100001,isMainPic:1,status:1},{fileId:100002,isMainPic:0,status:0}],fileIdList:[],sels:[],uploadData:{fileUrlType:1},loading:!1}},methods:{formatIsMainPic:function(e,t){return 1===e.isMainPic?"是":"否"},formatCreateTime:function(e,t){return this.$moment(e.createTime).format("YYYY-MM-DD HH:mm:ss")},getWareFileList:function(){var e=this;this.loading=!0;var t={wareId:this.wareId};(0,a.readWareFileList)(t).then(function(t){console.log(t),"0001"===t.data.code?e.mediaList=t.data.result.fileList:e.$message.error(t.data.message),e.loading=!1}).catch(function(t){e.loading=!1,e.catchError(t.response)})},beforeUpload:function(e){var t="image/jpeg"===e.type||"image/png"===e.type,i=e.size/1024/1024<2;return t||this.$message.error("图片只能是 JPG 或 PNG格式!"),i||this.$message.error("图片大小不能超过 2MB!"),t&&i},handleSuccess:function(e,t){if(this.fileList.push(t.url),"0001"===e.code){var i=e.result.file;t.path=i.filePath,this.fileList.push(i)}else this.$message.error(e.message)},handleError:function(e,t){console.log(t),this.$message.error("图片上传失败，请重试")},handleRemove:function(e){if(e){var t=this.fileList,i=e.path||"";t=t.filter(function(e){return e.filePath!==i}),this.fileList=t}},handleImgPreview:function(e,t){this.previewImgUrl=e.url,this.previewVisible=!0},onSubmit:function(){var e=this,t={wareId:this.wareId,fileList:this.fileList};console.log(t),(0,a.createWareFile)(t).then(function(t){"0001"===t.data.code?(e.$message.success("上传成功"),e.getWareFileList()):e.$message.error(t.data.message),e.uploadVisible=!1,e.fileList=[],e.$refs.uploadMedia.clearFiles()}).catch(function(t){e.catchError(t.response),e.uploadVisible=!1,e.fileList=[],e.$refs.uploadMedia.clearFiles()})},selsChange:function(e){this.sels=e},viewImage:function(e){this.previewImgUrl=e,this.previewVisible=!0},handleStatus:function(e){var t=this,i={fileId:e.fileId};(0,a.updatetWareFileState)(i).then(function(i){"0001"===i.data.code?t.$message.success(i.data.message):(e.status=1===e.status?0:1,t.$message.error(i.data.message))}).catch(function(i){e.status=1===e.status?0:1,t.catchError(i.response)})},handleSingleDelete:function(e){var t=this,i=[];i[0]={fileId:e.fileId},this.$confirm("确认删除该图片？","提示",{type:"warning"}).then(function(){var e={fileIdList:i};(0,a.deleteWareFile)(e).then(function(e){"0001"===e.data.code?(t.$message.success(e.data.message),t.getWareFileList()):t.$message.error(e.data.message)}).catch(function(e){t.catchError(e.response)})}).catch(function(e){console.log(e),t.$message("已取消操作")})},batchRemove:function(){var e=this;this.$confirm("确认删除选中的图片吗？","提示",{type:"warning"}).then(function(){var t=e.sels.map(function(e){return e.fileId}),i=[];t.forEach(function(e,t){i.push({fileId:e})});var s={fileIdList:i};(0,a.deleteWareFile)(s).then(function(t){"0001"===t.data.code?(e.$message.success(t.data.message),e.getWareFileList()):e.$message.error(t.data.message)}).catch(function(t){console.log(t),e.catchError(t.response)})}).catch(function(t){console.log(t),e.$message("已取消操作")})},handleSetMainImg:function(e){var t=this;if(0===e.status)return this.$notify({type:"warning",title:"提示",message:"请把该图片设为显示状态"}),!1;var i={wareId:this.wareId,fileId:e.fileId,isMainPic:1};(0,a.updateWareFileIsMainPic)(i).then(function(e){"0001"===e.data.code?(t.$message.success(e.data.message),t.getWareFileList()):t.$message.error(e.data.message)}).catch(function(e){t.catchError(e.response)})},handleNext:function(){this.$router.push("charge?wareId="+this.wareId)}},computed:{mediaLength:function(){return this.maxLength-this.mediaList.length-this.fileList.length}},mounted:function(){this.$store.dispatch("setStepActive",2),this.wareId=parseInt(this.$route.query.wareId),this.wareId&&this.getWareFileList()}}}});
//# sourceMappingURL=51.990cb9b153a3cc1d12a0.js.map